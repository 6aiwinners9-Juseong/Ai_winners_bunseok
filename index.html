<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주성사마 쇼츠 분석해서 카피 자동화</title>
    
    <!-- React & ReactDOM (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel (JSX 변환용) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Style -->
    <style>
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.3);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans selection:bg-yellow-200 selection:text-yellow-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons (Inline SVGs to avoid dependency issues) ---
        const Icon = ({ path, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Zap = (props) => <Icon {...props} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />} />;
        const Settings = (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />;
        const AlertCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>} />;
        const LinkIcon = (props) => <Icon {...props} path={<><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></>} />;
        const FileText = (props) => <Icon {...props} path={<><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></>} />;
        const HelpCircle = (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></>} />;
        const Sparkles = (props) => <Icon {...props} path={<path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>} />;
        const BarChart2 = (props) => <Icon {...props} path={<><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></>} />;
        const Scissors = (props) => <Icon {...props} path={<><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></>} />;
        const Layout = (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></>} />;
        const ImageIcon = (props) => <Icon {...props} path={<><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></>} />;
        const Video = (props) => <Icon {...props} path={<><path d="m22 8-6 4 6 4V8Z"/><rect width="14" height="12" x="2" y="6" rx="2" ry="2"/></>} />;
        const Check = (props) => <Icon {...props} path={<polyline points="20 6 9 17 4 12"/>} />;
        const Copy = (props) => <Icon {...props} path={<><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></>} />;
        const ExternalLink = (props) => <Icon {...props} path={<><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></>} />;
        const Gem = (props) => <Icon {...props} path={<path d="M6 3h12l4 6-10 13L2 9Z" />} />;
        const Save = (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></>} />;

        const ViralContentBuilder = () => {
            const [url, setUrl] = useState('');
            const [description, setDescription] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [activeStep, setActiveStep] = useState(0);
            const [result, setResult] = useState(null);
            const [copiedIndex, setCopiedIndex] = useState(null);
            const [toastMessage, setToastMessage] = useState(null);
            
            // 실제 작동을 위한 API Key 상태 관리
            const [apiKey, setApiKey] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [error, setError] = useState(null);

            // 컴포넌트 마운트 시 로컬 스토리지에서 API 키 불러오기
            useEffect(() => {
                const storedKey = localStorage.getItem('gemini_api_key');
                if (storedKey) {
                    setApiKey(storedKey);
                }
            }, []);

            // API 키 저장 핸들러
            const handleSaveApiKey = () => {
                localStorage.setItem('gemini_api_key', apiKey);
                setShowSettings(false);
                setToastMessage("API Key가 브라우저에 저장되었습니다.");
                setTimeout(() => setToastMessage(null), 3000);
            };

            // Gemini API 호출 함수 (모델 폴백 기능 추가)
            const callGeminiAPI = async (targetUrl, topic) => {
                // 시도할 모델 리스트 (우선순위 순)
                const modelsToTry = [
                    "gemini-1.5-flash",
                    "gemini-1.5-flash-latest", 
                    "gemini-1.5-flash-001",
                    "gemini-pro" // 최후의 수단
                ];

                const contentContext = topic 
                ? `Content Topic/Description: "${topic}"` 
                : `Content URL: "${targetUrl}" (User provided only URL. If you can't access the specific video, analyze the typical viral pattern for this platform and generate a plan for a "Trending Viral Hit" in Korea, assuming a popular category like Vlog, Cafe, or Humor.)`;

                const prompt = `
                You are a Viral Content Architect. Analyze the provided content info and create a viral content plan.
                
                Input Info:
                ${contentContext}
                ${targetUrl ? `Target Platform URL: ${targetUrl}` : ''}
                
                Task:
                1. Analyze why this type of content goes viral (Hook, Retention).
                2. Create a 6-scene script & storyboard.
                3. Generate prompts for Nano Banana Pro (Image) and Video Generation AI.
                4. Write a blog post draft.

                Return ONLY a raw JSON object (no markdown formatting) with the following structure:
                {
                    "analysis": { 
                    "hook": "Analysis of the hook (Korean)", 
                    "retention": "Retention strategy (Korean)", 
                    "viralFactor": "Why it goes viral (Korean)", 
                    "improvedStrategy": "How to improve it (Korean)" 
                    },
                    "scenes": [
                    {
                        "id": 1,
                        "script": "Narrator script or sound effect (Korean)",
                        "visualDesc": "Visual description (Korean)",
                        "imagePrompt": "High quality image generation prompt for Scene 1 (English, 8K, Photorealistic, Korean background/style, Nano Banana Pro style)",
                        "videoPrompt": "Video generation prompt for Scene 1 (English, Camera movement, etc)"
                    }
                    // ... Generate exactly 6 scenes
                    ],
                    "editingGuide": [
                    "Editing tip 1 (Korean)",
                    "Editing tip 2 (Korean)",
                    "Editing tip 3 (Korean)",
                    "Editing tip 4 (Korean)"
                    ],
                    "blogPost": {
                    "title": "Blog post title (Korean)",
                    "content": "Blog post content (Korean)"
                    }
                }
                `;

                let lastError = null;

                // 모델 리스트를 순회하며 요청 시도
                for (const model of modelsToTry) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: {
                            'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                            contents: [{
                                parts: [{ text: prompt }]
                            }]
                            })
                        });

                        if (!response.ok) {
                            // 404(모델 없음)면 다음 모델 시도, 그 외(403 키 오류 등)는 즉시 중단
                            if (response.status === 404) {
                                console.warn(`Model ${model} not found, trying next...`);
                                continue;
                            }
                            
                            const errorData = await response.json().catch(() => ({}));
                            const errorMessage = errorData.error?.message || 'API 호출 실패';
                            throw new Error(`Google API 오류 (${response.status}): ${errorMessage}`);
                        }

                        const data = await response.json();
                        const textResponse = data.candidates?.[0]?.content?.parts?.[0]?.text;
                        
                        if (!textResponse) {
                            continue; // 응답 형식이 이상하면 다음 모델 시도
                        }

                        const cleanJson = textResponse.replace(/```json/g, '').replace(/```/g, '').trim();
                        return JSON.parse(cleanJson);

                    } catch (err) {
                        console.error(`Error with model ${model}:`, err);
                        lastError = err;
                        // 키가 틀린 경우 등은 더 시도하지 않고 루프 탈출
                        if (err.message.includes("API Key") || err.message.includes("403")) {
                            throw err;
                        }
                    }
                }
                
                // 모든 모델 시도 실패 시 마지막 에러 투척
                throw lastError || new Error("사용 가능한 AI 모델을 찾을 수 없습니다.");
            };

            const generateContent = async () => {
                if (!description && !url) return;
                
                setError(null);
                setIsGenerating(true);
                setActiveStep(0);
                
                if (!apiKey) {
                runSimulation();
                return;
                }

                try {
                setActiveStep(1); 
                
                const aiData = await callGeminiAPI(url, description);
                
                setActiveStep(2);
                await new Promise(r => setTimeout(r, 800)); 
                setActiveStep(3);
                await new Promise(r => setTimeout(r, 800)); 
                setActiveStep(4);
                
                setResult(aiData);
                setActiveStep(5);
                } catch (err) {
                // 에러 메시지 표시
                setError(err.message);
                } finally {
                setIsGenerating(false);
                }
            };

            const runSimulation = () => {
                setTimeout(() => setActiveStep(1), 1500);
                setTimeout(() => setActiveStep(2), 3000);
                setTimeout(() => setActiveStep(3), 4500);
                setTimeout(() => setActiveStep(4), 6000);

                setTimeout(() => {
                const topic = description || "URL 기반 트렌드 분석 (자동 감지)";
                const generatedData = createMockData(topic);
                setResult(generatedData);
                setIsGenerating(false);
                setActiveStep(5);
                }, 7500);
            };

            const createMockData = (topic) => {
                return {
                analysis: {
                    hook: "초반 3초 시각적 충격과 반전 요소 (데모)",
                    retention: "빠른 컷 편집과 ASMR 사운드로 몰입도 유지",
                    viralFactor: "현실적인 공감대 형성과 고급스러운 영상미의 조화",
                    improvedStrategy: "기존 영상보다 색감의 대비를 높이고, 한국적인 배경을 더 디테일하게 묘사."
                },
                scenes: [
                    {
                    id: 1,
                    script: "(내레이션) 이거 아직도 모르는 사람 없죠? (데모 데이터)",
                    visualDesc: "서울 강남의 번화가, 비 온 뒤 젖은 아스팔트.",
                    imagePrompt: `Scene 1: Hyper-realistic 8K wide shot of a bustling Gangnam street at night after rain. --ar 9:16 --v 6.0`,
                    videoPrompt: `Cinematic drone shot, low angle, moving forward quickly.`,
                    },
                    {
                    id: 2,
                    script: "(효과음: 뚜벅뚜벅) 바로 여기입니다.",
                    visualDesc: "트렌디한 성수동 스타일의 카페 입구.",
                    imagePrompt: `Scene 2: Extreme close-up of a modern cafe entrance in Seongsu-dong style. --ar 9:16 --v 6.0`,
                    videoPrompt: `Handheld camera movement, approaching a glass door.`,
                    },
                    {
                    id: 3,
                    script: "(내레이션) 와... 이 비주얼 실화인가요?",
                    visualDesc: "테이블 위에 놓인 화려한 디저트.",
                    imagePrompt: `Scene 3: Top-down food photography shot of an exquisite dessert. --ar 9:16 --v 6.0`,
                    videoPrompt: `Slow orbit shot around a dessert.`,
                    },
                    {
                    id: 4,
                    script: "(내레이션) 진짜 대박인 건 따로 있어요.",
                    visualDesc: "주인공이 놀란 표정으로 무언가를 가리킴.",
                    imagePrompt: `Scene 4: Medium shot of a handsome Korean man looking shocked. --ar 9:16 --v 6.0`,
                    videoPrompt: `Camera zooms in quickly (Crash Zoom).`,
                    },
                    {
                    id: 5,
                    script: "(빠른 템포) 이렇게 하면 순식간에 해결됩니다.",
                    visualDesc: "빠르게 지나가는 해결 과정의 몽타주.",
                    imagePrompt: `Scene 5: Action shot, motion blur. Hands working on a project. --ar 9:16 --v 6.0`,
                    videoPrompt: `Time-lapse style or fast-forward motion.`,
                    },
                    {
                    id: 6,
                    script: "(내레이션) 더 자세한 정보는 프로필 링크 확인!",
                    visualDesc: "주인공이 스마트폰을 들고 웃으며 화면을 보여줌.",
                    imagePrompt: `Scene 6: Close-up of a smartphone screen being held up. --ar 9:16 --v 6.0`,
                    videoPrompt: `Camera focuses on the smartphone screen then racks focus.`,
                    },
                ],
                editingGuide: [
                    "Scene 1과 2 사이는 '줌인 트랜지션'으로 연결하세요.",
                    "글리치 효과와 임팩트 있는 효과음을 넣으세요.",
                    "Teal & Orange 톤으로 색보정하세요.",
                    "배경음악은 트렌디한 R&B로 구성하세요."
                ],
                blogPost: {
                    title: `[충격] ${topic} 아직도 모르시나요?`,
                    content: `안녕하세요! 오늘은 '${topic}'에 대해 이야기해보려 합니다.\n\n이 영상이 조회수가 폭발하는 이유는 시각적인 훅과 공감대 형성 때문입니다.\n\n(이 내용은 API Key를 입력하지 않아 생성된 데모 데이터입니다.)`
                }
                };
            };

            // Improved Copy Function with Fallback
            const copyTextToClipboard = async (text) => {
                // Try modern API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    try {
                        await navigator.clipboard.writeText(text);
                        return;
                    } catch (err) {
                        console.warn("Clipboard API failed, trying fallback...", err);
                    }
                }
                
                // Fallback using document.execCommand('copy')
                try {
                    const textArea = document.createElement("textarea");
                    textArea.value = text;
                    
                    // Avoid scrolling to bottom
                    textArea.style.position = "fixed";
                    textArea.style.left = "-9999px";
                    textArea.style.top = "0";
                    
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (!successful) {
                        throw new Error("Fallback copy failed.");
                    }
                } catch (err) {
                    console.error("Copy failed", err);
                    alert("복사에 실패했습니다. 브라우저 권한을 확인해주세요.");
                }
            };

            const copyToClipboard = async (text, index) => {
                await copyTextToClipboard(text);
                setCopiedIndex(index);
                setTimeout(() => setCopiedIndex(null), 2000);
            };

            const handleOpenGenerator = async (prompt) => {
                await copyTextToClipboard(prompt);
                
                setToastMessage("프롬프트가 복사되었습니다! 자동으로 열리는 창에서 Ctrl+V 하세요.");
                setTimeout(() => setToastMessage(null), 4000);

                const baseUrl = "https://nano-banana-pro.ai/generate"; 
                const targetUrl = `${baseUrl}?prompt=${encodeURIComponent(prompt)}`;
                
                window.open(targetUrl, '_blank');
            };

            return (
                <div className="relative min-h-screen">
                    {toastMessage && (
                        <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-50 animate-in">
                        <div className="bg-gray-900/90 text-white px-6 py-3 rounded-full shadow-2xl flex items-center space-x-3 backdrop-blur-sm border border-gray-700">
                            <Check className="w-5 h-5 text-green-400" />
                            <span className="font-medium text-sm">{toastMessage}</span>
                        </div>
                        </div>
                    )}

                    <header className="border-b border-gray-200 bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
                        <div className="max-w-6xl mx-auto px-4 h-16 flex items-center justify-between">
                        <div className="flex items-center space-x-3">
                            <div className="w-9 h-9 bg-gradient-to-br from-yellow-300 via-amber-400 to-yellow-600 rounded-lg flex items-center justify-center shadow-lg border border-yellow-200">
                            <Gem className="w-5 h-5 text-white drop-shadow-sm" />
                            </div>
                            <span className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-amber-600 to-yellow-500">
                            주성사마 쇼츠 분석해서 카피 자동화
                            </span>
                        </div>
                        <div className="flex items-center space-x-4">
                            {!apiKey && (
                            <span className="hidden md:inline-flex text-xs bg-yellow-100 text-yellow-700 px-3 py-1.5 rounded-full border border-yellow-200 items-center font-medium">
                                <AlertCircle className="w-3.5 h-3.5 mr-1.5" />
                                Demo Mode
                            </span>
                            )}
                            <button 
                            onClick={() => setShowSettings(!showSettings)}
                            className="p-2 hover:bg-gray-100 rounded-full transition text-gray-500 hover:text-gray-900"
                            title="Settings & API Key"
                            >
                            <Settings className="w-5 h-5" />
                            </button>
                        </div>
                        </div>
                    </header>

                    {showSettings && (
                        <div className="border-b border-gray-200 bg-white p-6 animate-in shadow-inner">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row items-start md:items-center gap-4">
                            <div className="flex-1 w-full">
                            <label className="block text-xs font-bold text-gray-500 uppercase mb-2">Google Gemini API Key</label>
                            <input 
                                type="password" 
                                value={apiKey}
                                onChange={(e) => setApiKey(e.target.value)}
                                placeholder="Enter your AI Studio API Key (Start with AIza...)"
                                className="w-full bg-gray-50 border border-gray-300 rounded-lg px-4 py-2.5 text-sm focus:ring-2 focus:ring-yellow-500 focus:border-transparent outline-none transition text-gray-900 placeholder-gray-400"
                            />
                            <p className="text-xs text-gray-500 mt-2 flex items-center">
                                <span className="inline-block w-1.5 h-1.5 rounded-full bg-green-500 mr-1.5"></span>
                                API Key가 있으면 실제 AI가 분석/생성을 수행합니다.
                                <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noreferrer" className="text-amber-600 font-semibold hover:underline ml-2">
                                키 발급받기 &rarr;
                                </a>
                            </p>
                            </div>
                            {/* [수정됨] 닫기 버튼 대신 저장 버튼으로 변경 */}
                            <button 
                                onClick={handleSaveApiKey}
                                className="flex items-center justify-center space-x-2 bg-yellow-500 hover:bg-yellow-600 text-white px-5 py-2.5 rounded-lg text-sm font-bold transition shadow-md hover:shadow-lg"
                            >
                                <Save className="w-4 h-4" />
                                <span>저장하기</span>
                            </button>
                        </div>
                        </div>
                    )}

                    <main className="max-w-6xl mx-auto px-4 py-8">
                        {error && (
                        <div className="mb-6 bg-red-50 border border-red-200 text-red-600 p-4 rounded-xl flex items-center space-x-3 shadow-sm">
                            <AlertCircle className="w-5 h-5 flex-shrink-0" />
                            <span>{error}</span>
                        </div>
                        )}

                        <div className="bg-white rounded-2xl p-6 mb-8 border border-gray-200 shadow-lg">
                        <div className="flex flex-col md:flex-row gap-6">
                            <div className="flex-1 space-y-6">
                            
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center justify-between">
                                <span className="flex items-center">
                                    <LinkIcon className="h-4 w-4 mr-1.5 text-pink-500" />
                                    분석할 레퍼런스 URL (필수 또는 선택)
                                </span>
                                {url && !description && (
                                    <span className="text-xs text-pink-600 font-medium bg-pink-50 px-2 py-0.5 rounded-full animate-pulse">
                                    URL 기반 자동 분석 모드
                                    </span>
                                )}
                                </label>
                                <div className="relative">
                                <input 
                                    type="text" 
                                    value={url}
                                    onChange={(e) => setUrl(e.target.value)}
                                    placeholder="https://www.instagram.com/reels/... 또는 YouTube Shorts 링크"
                                    className="w-full bg-gray-50 border border-gray-200 rounded-xl py-3 px-4 focus:ring-2 focus:ring-yellow-500 focus:bg-white outline-none transition text-gray-900 placeholder-gray-400"
                                />
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2 flex items-center justify-between">
                                <span className="flex items-center">
                                    <FileText className="h-4 w-4 mr-1.5 text-blue-500" />
                                    제작하고 싶은 영상 설명 (선택)
                                </span>
                                <span className="text-xs text-gray-500 font-medium bg-gray-100 px-2 py-0.5 rounded-full">
                                    AI에게 내리는 지령 (비워두면 URL 기반 자동 생성)
                                </span>
                                </label>
                                
                                <div className="bg-blue-50 border border-blue-100 rounded-lg p-3 mb-2">
                                <div className="flex items-start space-x-2">
                                    <HelpCircle className="w-4 h-4 text-blue-500 mt-0.5 flex-shrink-0" />
                                    <div className="text-xs text-blue-800 leading-relaxed">
                                    <strong>Tip:</strong> URL만 입력해도 AI가 해당 링크의 플랫폼 특성에 맞는 트렌디한 영상을 기획해줍니다. 더 정확한 결과를 원하시면 설명을 추가해주세요.
                                    </div>
                                </div>
                                </div>

                                <textarea 
                                value={description}
                                onChange={(e) => setDescription(e.target.value)}
                                placeholder="예시) 서울 성수동의 힙한 빈티지 카페 브이로그를 만들고 싶어. 비 오는 날 창가 자리의 감성적인 분위기와 따뜻한 라떼 아트가 포인트야. 마지막에는 카페 사장님의 반전 멘트로 웃기게 끝내줘."
                                className="w-full bg-gray-50 border border-gray-200 rounded-xl py-3 px-4 h-32 focus:ring-2 focus:ring-yellow-500 focus:bg-white outline-none transition resize-none text-gray-900 placeholder-gray-400 leading-relaxed"
                                />
                            </div>
                            </div>

                            <div className="flex flex-col justify-end md:w-56">
                            <button 
                                onClick={generateContent}
                                disabled={isGenerating || (!description && !url)}
                                className={`h-16 rounded-2xl font-bold text-lg flex items-center justify-center space-x-2 transition-all transform hover:-translate-y-1 shadow-md ${
                                isGenerating || (!description && !url)
                                    ? 'bg-gray-200 text-gray-400 cursor-not-allowed shadow-none' 
                                    : 'bg-gradient-to-r from-amber-500 to-yellow-500 text-white hover:from-amber-400 hover:to-yellow-400 shadow-yellow-200'
                                }`}
                            >
                                {isGenerating ? (
                                <>
                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                                    <span>
                                    {apiKey ? 'AI 기획 중...' : '분석 시뮬레이션...'}
                                    </span>
                                </>
                                ) : (
                                <>
                                    <Sparkles className="w-5 h-5 fill-current" />
                                    <span>콘텐츠 자동 생성</span>
                                </>
                                )}
                            </button>
                            </div>
                        </div>
                        </div>

                        {isGenerating && (
                        <div className="mb-8 grid grid-cols-4 gap-4">
                            {['성공 요인 분석', '대본 & 이미지 프롬프트', '영상 생성 프롬프트', '편집 & 블로그 발행'].map((step, idx) => (
                            <div key={idx} className={`relative overflow-hidden rounded-xl p-4 text-center border transition-all duration-500 shadow-sm ${
                                activeStep > idx ? 'bg-yellow-50 border-yellow-200 text-yellow-700' : 
                                activeStep === idx ? 'bg-white border-yellow-500 text-yellow-900 ring-2 ring-yellow-100' : 
                                'bg-gray-50 border-gray-200 text-gray-400'
                            }`}>
                                <div className="text-xs font-bold uppercase tracking-wider mb-1 opacity-70">Step {idx + 1}</div>
                                <div className="text-sm font-bold">{step}</div>
                            </div>
                            ))}
                        </div>
                        )}

                        {result && !isGenerating && (
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in">
                            <div className="lg:col-span-1 space-y-6">
                            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg">
                                <h3 className="flex items-center space-x-2 text-lg font-bold text-gray-800 mb-4 pb-3 border-b border-gray-100">
                                <div className="p-1.5 bg-green-100 rounded-lg text-green-600">
                                    <BarChart2 className="w-5 h-5" />
                                </div>
                                <span>AI 분석 리포트</span>
                                </h3>
                                <div className="space-y-4">
                                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <span className="text-xs text-gray-500 uppercase font-bold block mb-1.5">Viral Hook</span>
                                    <p className="text-sm text-gray-800 font-medium leading-relaxed">{result.analysis.hook}</p>
                                </div>
                                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <span className="text-xs text-gray-500 uppercase font-bold block mb-1.5">Retention Strategy</span>
                                    <p className="text-sm text-gray-800 font-medium leading-relaxed">{result.analysis.retention}</p>
                                </div>
                                <div className="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                                    <span className="text-xs text-yellow-600 uppercase font-bold block mb-1.5">Upgrade Plan</span>
                                    <p className="text-sm text-yellow-900 font-medium leading-relaxed">{result.analysis.improvedStrategy}</p>
                                </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg">
                                <h3 className="flex items-center space-x-2 text-lg font-bold text-gray-800 mb-4 pb-3 border-b border-gray-100">
                                <div className="p-1.5 bg-blue-100 rounded-lg text-blue-600">
                                    <Scissors className="w-5 h-5" />
                                </div>
                                <span>편집 가이드</span>
                                </h3>
                                <ul className="space-y-4">
                                {result.editingGuide.map((guide, idx) => (
                                    <li key={idx} className="flex items-start space-x-3 text-sm text-gray-700">
                                    <span className="flex-shrink-0 w-6 h-6 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold border border-blue-100">{idx + 1}</span>
                                    <span className="mt-0.5 leading-relaxed">{guide}</span>
                                    </li>
                                ))}
                                </ul>
                            </div>
                            </div>

                            <div className="lg:col-span-2 space-y-6">
                            <div className="bg-white rounded-2xl border border-gray-200 shadow-lg overflow-hidden">
                                <div className="bg-white p-5 border-b border-gray-200 flex justify-between items-center">
                                <h3 className="flex items-center space-x-2 text-lg font-bold text-gray-800">
                                    <div className="p-1.5 bg-purple-100 rounded-lg text-purple-600">
                                    <Layout className="w-5 h-5" />
                                    </div>
                                    <span>6-Scene Pipeline</span>
                                </h3>
                                <span className="text-xs bg-purple-50 text-purple-700 px-3 py-1.5 rounded-full font-semibold border border-purple-100">Nano Banana Pro Optimized</span>
                                </div>
                                
                                <div className="divide-y divide-gray-100">
                                {result.scenes.map((scene) => (
                                    <div key={scene.id} className="p-6 hover:bg-gray-50 transition-colors">
                                    <div className="flex justify-between items-start mb-5">
                                        <span className="inline-flex items-center justify-center px-3 py-1 rounded-full bg-gray-900 text-xs font-bold text-white shadow-sm">
                                        SCENE {scene.id}
                                        </span>
                                    </div>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                        <div className="space-y-5">
                                        <div>
                                            <span className="text-xs text-gray-400 font-bold uppercase tracking-wide">Script (Audio)</span>
                                            <p className="text-gray-900 font-semibold bg-white p-4 rounded-xl border border-gray-200 shadow-sm mt-2 leading-relaxed text-lg">
                                            {scene.script}
                                            </p>
                                        </div>
                                        <div>
                                            <span className="text-xs text-gray-400 font-bold uppercase tracking-wide">Visual Content</span>
                                            <p className="text-sm text-gray-600 mt-2 leading-relaxed">{scene.visualDesc}</p>
                                        </div>
                                        </div>

                                        <div className="space-y-4">
                                        <div className="relative group">
                                            <div className="flex justify-between items-center mb-2">
                                            <span className="text-xs text-pink-600 font-bold uppercase flex items-center bg-pink-50 px-2 py-0.5 rounded">
                                                <ImageIcon className="w-3 h-3 mr-1.5" /> Image Prompt
                                            </span>
                                            
                                            <div className="flex space-x-1">
                                                <button 
                                                onClick={() => copyToClipboard(scene.imagePrompt, `img-${scene.id}`)}
                                                className="text-gray-400 hover:text-pink-500 transition p-1"
                                                title="Copy Prompt Only"
                                                >
                                                {copiedIndex === `img-${scene.id}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                                </button>
                                                <button 
                                                onClick={() => handleOpenGenerator(scene.imagePrompt)}
                                                className="flex items-center space-x-1 text-xs bg-pink-100 hover:bg-pink-200 text-pink-700 px-2 py-1 rounded-md transition font-bold"
                                                title="Open Nano Banana Pro & Auto-Enter Prompt"
                                                >
                                                <span>생성</span>
                                                <ExternalLink className="w-3 h-3" />
                                                </button>
                                            </div>
                                            </div>
                                            <div className="bg-gray-900 p-4 rounded-xl text-xs text-gray-300 font-mono leading-relaxed h-28 overflow-y-auto custom-scrollbar shadow-inner">
                                            {scene.imagePrompt}
                                            </div>
                                        </div>

                                        <div className="relative group">
                                            <div className="flex justify-between items-center mb-2">
                                            <span className="text-xs text-blue-600 font-bold uppercase flex items-center bg-blue-50 px-2 py-0.5 rounded">
                                                <Video className="w-3 h-3 mr-1.5" /> Video Gen Prompt
                                            </span>
                                            <button 
                                                onClick={() => copyToClipboard(scene.videoPrompt, `vid-${scene.id}`)}
                                                className="text-gray-400 hover:text-blue-500 transition"
                                                title="Copy Prompt"
                                            >
                                                {copiedIndex === `vid-${scene.id}` ? <Check className="w-4 h-4 text-green-500" /> : <Copy className="w-4 h-4" />}
                                            </button>
                                            </div>
                                            <div className="bg-gray-900 p-4 rounded-xl text-xs text-gray-300 font-mono leading-relaxed h-28 overflow-y-auto custom-scrollbar shadow-inner">
                                            {scene.videoPrompt}
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                ))}
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl p-6 border border-gray-200 shadow-lg">
                                <div className="flex justify-between items-center mb-5 pb-3 border-b border-gray-100">
                                <h3 className="flex items-center space-x-2 text-lg font-bold text-gray-800">
                                    <div className="p-1.5 bg-orange-100 rounded-lg text-orange-600">
                                    <FileText className="w-5 h-5" />
                                    </div>
                                    <span>자동 생성 블로그 초안</span>
                                </h3>
                                <button 
                                    onClick={() => copyToClipboard(`${result.blogPost.title}\n\n${result.blogPost.content}`, 'blog')}
                                    className="flex items-center space-x-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition font-medium"
                                >
                                    {copiedIndex === 'blog' ? <Check className="w-3.5 h-3.5 text-green-600" /> : <Copy className="w-3.5 h-3.5" />}
                                    <span>전체 복사</span>
                                </button>
                                </div>
                                <div className="bg-gray-50 p-6 rounded-xl text-gray-800 border border-gray-100">
                                <h1 className="text-xl font-bold mb-4 text-gray-900">{result.blogPost.title}</h1>
                                <p className="whitespace-pre-line text-sm leading-relaxed text-gray-700">
                                    {result.blogPost.content}
                                </p>
                                </div>
                            </div>
                            </div>
                        </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ViralContentBuilder />);
    </script>
</body>
</html>